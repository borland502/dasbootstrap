- name: Update Proxmox Nodes
  hosts: proxmox_nodes
  remote_user: root
  gather_facts: true
  vars:
    ansible_python_interpreter: /usr/bin/python3
  pre_tasks:
    - name: Make github directory
      ansible.builtin.file:
        path: /srv/github/Proxmox
        mode: "0700"
        owner: "root"
        group: "root"
        state: directory

    - name: Make all .sh files executable recursively
      ansible.builtin.file:
        path: "/srv/github/Proxmox"
        recurse: true
        owner: root
        group: root
        mode: "0700"


    - name: Clone Proxmox VE Helper-Scripts
      ansible.builtin.git:
        repo: "https://github.com/tteck/Proxmox"
        dest: /srv/github/Proxmox
        clone: true
        update: true
        force: true
        single_branch: true
        version: main

  tasks:
    - name: Update apt
      ansible.builtin.apt:
        update_cache: true
        upgrade: true
        autoremove: false
        autoclean: false
